require 'spec_helper'

describe SalesOrdersController do
  let(:tenant) { instance_double("Tenant", time_zone: "Beijing").as_null_object }
  let(:user) { instance_double("User", admin?: false, tenant: tenant).as_null_object }
  let(:sales_orders) { double }
  let(:sales_order) { instance_double("SalesOrder").as_null_object }
  let(:new_sales_order) { instance_double("SalesOrder").as_null_object }

  before do
    set_user_session(user)
    allow(tenant).to receive(:sales_orders) { sales_orders }
    allow(sales_orders).to receive(:find).with("1") { sales_order }
    allow(tenant).to receive(:new_sales_order) { new_sales_order }
  end

  describe "#index" do
    let(:paged_sales_orders) { double }
    before do
      allow(sales_orders).to receive(:page).with("2") { paged_sales_orders }
      get :index, page: 2
    end

    it "assigns current tenant sales_orders" do
      expect(assigns(:sales_orders)).to eq(paged_sales_orders)
    end
  end
end
