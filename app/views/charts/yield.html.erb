<%= form_tag yield_chart_path, method: :get, class: 'form-inline search' do %>
    <div class="form-group">
      <%= text_field_tag :start_serial, params[:start_serial], placeholder: "Start Serial", class: "form-control" %>
    </div>
    <div class="form-group">
      <%= text_field_tag :end_serial, params[:end_serial], placeholder: "End Serial", class: "form-control" %>
    </div>
    <%= submit_tag "Search", name: nil, class: "btn btn-default" %>
<% end %>

<script>
  $(function () {
    $('#yield').highcharts({
      chart: {
        type: 'spline'
      },
      title: {
        text: 'Yield by week'
      },
      xAxis: {
        type: 'datetime',
        title: {
          text: 'Beginning of lamination week'
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: '% Yield'
        },
        plotLines: [{
          color: 'red',
          value: <%= @overall_average %>,
          width: 2,
          label: {
            align: 'right',
            text: "<%= @overall_average %>"
          }
        }]
      },
      series: [{
        yAxis: 0,
        name: 'Yield',
        data: [
        <% @data.each do |point| %>
          [<%= point[:week_start].to_datetime.to_i*1000 %>, <%= point[:average_yield] %>],
        <% end %>
        ]
      }]
    });
  });
</script>
<div id="yield" class="chart"></div>
